<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form 8.3 Information Extractor</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: #1a1a1a;
min-height: 100vh;
padding: 20px;
color: #e0e0e0;
}

.container {
max-width: 1400px;
margin: 0 auto;
background: #2a2a2a;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0,0,0,0.5);
overflow: hidden;
}

.header {
background: #000;
color: #e0e0e0;
padding: 30px;
text-align: center;
border-bottom: 1px solid #3a3a3a;
}

.header h1 {
font-size: 2rem;
margin-bottom: 10px;
}

.header p {
opacity: 0.7;
font-size: 0.95rem;
}

.content {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 30px;
padding: 30px;
}

@media (max-width: 1024px) {
.content {
grid-template-columns: 1fr;
}
}

.panel {
background: #333;
border-radius: 8px;
padding: 25px;
border: 1px solid #444;
}

.panel h2 {
color: #ccc;
margin-bottom: 20px;
font-size: 1.3rem;
display: flex;
align-items: center;
gap: 10px;
}

.form-group {
margin-bottom: 20px;
}

.form-group label {
display: block;
margin-bottom: 8px;
color: #ccc;
font-weight: 600;
font-size: 0.9rem;
}

.form-group input,
.form-group textarea {
width: 100%;
padding: 12px;
border: 1px solid #555;
border-radius: 4px;
font-size: 0.95rem;
transition: all 0.3s;
font-family: inherit;
background: #2a2a2a;
color: #e0e0e0;
}

.form-group input:focus,
.form-group textarea:focus {
outline: none;
border-color: #777;
background: #222;
}

.form-group textarea {
resize: vertical;
min-height: 150px;
font-family: 'Courier New', monospace;
font-size: 0.85rem;
}

.btn {
background: #444;
color: #e0e0e0;
border: 1px solid #555;
padding: 14px 28px;
border-radius: 4px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
width: 100%;
margin-top: 10px;
}

.btn:hover {
background: #555;
border-color: #666;
}

.btn:active {
background: #333;
}

.btn:disabled {
opacity: 0.4;
cursor: not-allowed;
}

.btn-secondary {
background: #555;
}

.btn-secondary:hover {
background: #666;
}

.output-area {
background: #1a1a1a;
color: #d4d4d4;
padding: 20px;
border-radius: 4px;
font-family: 'Courier New', monospace;
font-size: 0.85rem;
max-height: 600px;
overflow-y: auto;
white-space: pre-wrap;
word-wrap: break-word;
border: 1px solid #333;
}

.status {
padding: 12px;
border-radius: 4px;
margin-bottom: 20px;
font-size: 0.9rem;
}

.status.success {
background: #1a3a1a;
color: #6f6;
border: 1px solid #2a5a2a;
}

.status.error {
background: #3a1a1a;
color: #f66;
border: 1px solid #5a2a2a;
}

.status.info {
background: #1a2a3a;
color: #6cf;
border: 1px solid #2a4a5a;
}

.loading {
display: inline-block;
width: 16px;
height: 16px;
border: 3px solid rgba(255,255,255,.3);
border-radius: 50%;
border-top-color: #fff;
animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.tabs {
display: flex;
gap: 10px;
margin-bottom: 20px;
border-bottom: 1px solid #444;
}

.tab {
padding: 10px 20px;
background: transparent;
border: none;
border-bottom: 2px solid transparent;
cursor: pointer;
font-size: 0.95rem;
font-weight: 600;
color: #888;
transition: all 0.3s;
}

.tab.active {
color: #ccc;
border-bottom-color: #666;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.metadata {
background: #2a2a2a;
padding: 15px;
border-radius: 4px;
margin-bottom: 15px;
font-size: 0.85rem;
border: 1px solid #444;
}

.metadata-item {
display: flex;
justify-content: space-between;
margin-bottom: 8px;
}

.metadata-label {
font-weight: 600;
color: #999;
}

.copy-btn {
background: #3a3a3a;
padding: 8px 16px;
font-size: 0.85rem;
margin-bottom: 10px;
}

.icon {
font-size: 1.2rem;
}

.help-text {
font-size: 0.85rem;
color: #888;
margin-top: 5px;
font-style: italic;
}

select {
width: 100%;
padding: 12px;
border: 1px solid #555;
border-radius: 4px;
font-size: 0.95rem;
background: #2a2a2a;
color: #e0e0e0;
}

select:focus {
outline: none;
border-color: #777;
background: #222;
}

button[type="button"] {
padding: 5px 10px;
font-size: 0.8rem;
background: #444;
border: 1px solid #555;
border-radius: 4px;
cursor: pointer;
color: #ccc;
}

button[type="button"]:hover {
background: #555;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>Form 8.3 Information Extractor</h1>
<p>CS516: Information Retrieval & Text Mining Project | Hybrid IR+NLP+LLM Extraction</p>
</div>

<div class="content">
<div class="panel">
<h2>Input Configuration</h2>

<div class="tabs">
<button class="tab active" onclick="switchTab('newsId')">By News ID</button>
<button class="tab" onclick="switchTab('rawText')">By Raw Text</button>
</div>

<div id="newsIdTab" class="tab-content active">
<div class="form-group">
<label for="newsId">LSE News ID</label>
<input type="text" id="newsId" placeholder="17355111" value="17355111">
<p class="help-text">Enter the news article ID from London Stock Exchange</p>
<div style="display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;">
<button type="button" onclick="setNewsId('17355006')">Form 1</button>
<button type="button" onclick="setNewsId('17355111')">Form 2</button>
<button type="button" onclick="setNewsId('17355083')">Form 3</button>
</div>
</div>

<div class="form-group">
<label for="method">Extraction Method</label>
<select id="method">
<option value="hybrid" selected>Hybrid Approach for Max Accuracy (NLP + LLM) - RECOMMENDED</option>
<option value="nlp">NLP-based (spaCy+NLTK+NER)</option>
<option value="llm">LLM-based (Gemini)</option>
<option value="proximity">Proximity-based (Simple Rules)</option>
</select>
<p class="help-text">Hybrid: NLP for key_information & other_information, LLM for positions & dealings</p>
</div>

<button class="btn" onclick="testScraper()">
Test Scraper
</button>

<button class="btn btn-secondary" onclick="extractFromNewsId()">
Extract Data
</button>
</div>

<div id="rawTextTab" class="tab-content">
<div class="form-group">
<label for="rawText">Raw Form Text</label>
<textarea id="rawText" placeholder="Paste the raw text from Form 8.3 here..."></textarea>
</div>

<div class="form-group">
<label for="method2">Extraction Method</label>
<select id="method2">
<option value="hybrid" selected>Hybrid Approach for Max Accuracy (NLP + LLM) - RECOMMENDED</option>
<option value="nlp">NLP-based (spaCy+NLTK+NER)</option>
<option value="llm">LLM-based (Gemini)</option>
<option value="proximity">Proximity-based (Simple Rules)</option>
</select>
<p class="help-text">Hybrid: NLP for key_information & other_information, LLM for positions & dealings</p>
</div>

<button class="btn btn-secondary" onclick="extractFromText()">
Extract Data
</button>
</div>

<div id="statusMessage"></div>
</div>

<div class="panel">
<h2><span class="icon"></span> Extraction Results</h2>

<div id="metadata"></div>

<button class="btn copy-btn" onclick="copyToClipboard()" style="display: none;" id="copyBtn">
Copy JSON
</button>

<div class="output-area" id="output">
<span style="color: #666;">Extraction results will appear here...</span>
</div>
</div>
</div>
</div>

<script>
function setNewsId(id) {
document.getElementById('newsId').value = id;
}

function switchTab(tabName) {
document.querySelectorAll('.tab').forEach(tab => {
tab.classList.remove('active');
});
event.target.classList.add('active');

document.querySelectorAll('.tab-content').forEach(content => {
content.classList.remove('active');
});
document.getElementById(tabName + 'Tab').classList.add('active');
}

function showStatus(message, type) {
const statusDiv = document.getElementById('statusMessage');
statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
setTimeout(() => {
statusDiv.innerHTML = '';
}, 5000);
}

function showMetadata(data) {
const metadataDiv = document.getElementById('metadata');
let html = '<div class="metadata">';

if (data.news_id) {
html += `<div class="metadata-item"><span class="metadata-label">News ID:</span><span>${data.news_id}</span></div>`;
}
if (data.raw_text_length) {
html += `<div class="metadata-item"><span class="metadata-label">Text Length:</span><span>${data.raw_text_length} chars</span></div>`;
}
if (data.extraction_model) {
html += `<div class="metadata-item"><span class="metadata-label">Model:</span><span>${data.extraction_model}</span></div>`;
}
if (data.temperature !== undefined) {
html += `<div class="metadata-item"><span class="metadata-label">Temperature:</span><span>${data.temperature}</span></div>`;
}

html += '</div>';
metadataDiv.innerHTML = html;
}

async function testScraper() {
const newsId = document.getElementById('newsId').value;

if (!newsId) {
showStatus('Please enter a News ID', 'error');
return;
}

const outputDiv = document.getElementById('output');
outputDiv.innerHTML = '<div class="loading"></div> Testing scraper...';

try {
const response = await fetch('/api/test-scraper', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ news_id: newsId })
});

const data = await response.json();

if (response.ok) {
outputDiv.textContent = JSON.stringify(data, null, 2);
showStatus('Scraper test successful!', 'success');
} else {
outputDiv.textContent = 'Error: ' + data.detail;
showStatus('Scraper test failed', 'error');
}
} catch (error) {
outputDiv.textContent = 'Error: ' + error.message;
showStatus('Network error occurred', 'error');
}
}

async function extractFromNewsId() {
const newsId = document.getElementById('newsId').value;
const method = document.getElementById('method').value;

if (!newsId) {
showStatus('Please enter a News ID', 'error');
return;
}

const outputDiv = document.getElementById('output');
outputDiv.innerHTML = '<div class="loading"></div> Scraping and extracting data...';
showStatus('Processing... This may take 30-60 seconds', 'info');

try {
const response = await fetch('/api/extract', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
news_id: newsId,
method: method
})
});

const data = await response.json();

if (response.ok) {
displayResults(data);
document.getElementById('copyBtn').style.display = 'block';
showStatus('Extraction completed successfully!', 'success');
} else {
outputDiv.textContent = 'Error: ' + data.detail;
showStatus('Extraction failed', 'error');
}
} catch (error) {
outputDiv.textContent = 'Error: ' + error.message;
showStatus('Network error occurred', 'error');
}
}

async function extractFromText() {
const rawText = document.getElementById('rawText').value;
const method = document.getElementById('method2').value;

if (!rawText) {
showStatus('Please paste the raw text', 'error');
return;
}

const outputDiv = document.getElementById('output');
outputDiv.innerHTML = '<div class="loading"></div> Extracting data...';
showStatus('Processing... This may take 20 seconds', 'info');

try {
const response = await fetch('/api/extract-from-text', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
raw_text: rawText,
method: method
})
});

const data = await response.json();

if (response.ok) {
displayResults(data);
document.getElementById('copyBtn').style.display = 'block';
showStatus('Extraction completed successfully!', 'success');
} else {
outputDiv.textContent = 'Error: ' + data.detail;
showStatus('Extraction failed', 'error');
}
} catch (error) {
outputDiv.textContent = 'Error: ' + error.message;
showStatus('Network error occurred', 'error');
}
}

function displayResults(data) {
const outputDiv = document.getElementById('output');
const metadataDiv = document.getElementById('metadata');

if (data.method === 'both' && data.comparison) {
let html = '<div style="color: #d4d4d4;">';

html += '<div style="background: #444; color: white; padding: 15px; border-radius: 4px; margin-bottom: 15px;">';
html += '<h3 style="margin: 0 0 10px 0;">Comparison Results</h3>';
html += `<p>Similarity: ${data.comparison.overall_similarity}% | `;
html += `Matching Fields: ${data.comparison.matching_fields}/${data.comparison.total_compared_fields}</p>`;
html += `<p>Speed: Proximity ${data.comparison.speed_difference.proximity_time}s vs `;
html += `LLM ${data.comparison.speed_difference.llm_time}s `;
html += `(${data.comparison.speed_difference.speedup}x faster)</p>`;
html += '</div>';

html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">';
html += '<div style="background: #2a2a2a; padding: 10px; border-radius: 4px;">';
html += '<h4 style="color: #6f6; margin: 0 0 10px 0;">Proximity-based</h4>';
html += '<pre style="margin: 0; font-size: 0.75rem; overflow-x: auto;">' +
JSON.stringify(data.proximity_extraction.data, null, 2) + '</pre>';
html += '</div>';
html += '<div style="background: #2a2a2a; padding: 10px; border-radius: 4px;">';
html += '<h4 style="color: #f99; margin: 0 0 10px 0;">LLM-based</h4>';
html += '<pre style="margin: 0; font-size: 0.75rem; overflow-x: auto;">' +
JSON.stringify(data.llm_extraction.data, null, 2) + '</pre>';
html += '</div>';
html += '</div>';
html += '</div>';

outputDiv.innerHTML = html;
} else if (data.hybrid_extraction) {
let html = '<div style="color: #d4d4d4;">';

html += '<div style="background: #444; color: white; padding: 15px; border-radius: 4px; margin-bottom: 15px;">';
html += '<h3 style="margin: 0 0 10px 0;">Hybrid Approach for Max Accuracy</h3>';
html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">';
html += '<div><strong>NLP Fields:</strong> ' + data.hybrid_extraction.breakdown.nlp_fields.join(', ') + '</div>';
html += '<div><strong>LLM Fields:</strong> ' + data.hybrid_extraction.breakdown.llm_fields.join(', ') + '</div>';
html += '</div>';
html += `<div style="margin-top: 10px; font-size: 0.85rem; opacity: 0.9;">Total Time: ${data.hybrid_extraction.time_seconds}s</div>`;
html += '</div>';

html += '<pre style="margin: 0; font-size: 0.85rem; overflow-x: auto;">' +
JSON.stringify(data.hybrid_extraction.data, null, 2) + '</pre>';
html += '</div>';

outputDiv.innerHTML = html;
showMetadata({...data.metadata, method: 'Hybrid (NLP + LLM)', time: data.hybrid_extraction.time_seconds + 's'});
} else if (data.nlp_extraction) {
outputDiv.textContent = JSON.stringify(data.nlp_extraction.data, null, 2);
showMetadata({...data.metadata, method: 'NLP-based (spaCy+NLTK)', time: data.nlp_extraction.time_seconds + 's'});
} else if (data.proximity_extraction) {
outputDiv.textContent = JSON.stringify(data.proximity_extraction.data, null, 2);
showMetadata({...data.metadata, method: 'Proximity-based', time: data.proximity_extraction.time_seconds + 's'});
} else if (data.llm_extraction) {
outputDiv.textContent = JSON.stringify(data.llm_extraction.data, null, 2);
showMetadata({...data.metadata, method: 'LLM-based', time: data.llm_extraction.time_seconds + 's', model: data.llm_extraction.model});
}
}

function copyToClipboard() {
const output = document.getElementById('output').textContent;
navigator.clipboard.writeText(output).then(() => {
showStatus('Copied to clipboard!', 'success');
});
}
</script>
</body>
</html>
